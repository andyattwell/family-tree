<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline'"
    />
    <title>Hello Electron React!</title>
  </head>
  <body>
    <div id="root">
        <canvas id="treeCanvas"></canvas>
    </div>

    <style>
        body {
            background-color: black;
            color: white;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
    </style>

    <script type="module">
    class Visualizer {
        requestId = null;
        ctx = null;
        tree = {
                name: "item 1",
                color: "red",
                children: [
                    {
                        name: "children 1",
                        color: "blue",
                        children: [
                            {
                                name: "children 1 children 1",
                                color: "yellow",
                                children: [],
                                parents: []
                            },
                            {
                                name: "children 1 children 2",
                                color: "yellow",
                                children: [],
                                parents: []
                            }
                        ]
                    },
                    {
                        name: "children 2",
                        color: "blue",
                        children: [
                            {
                                name: "children 1 children 1",
                                color: "white",
                                children: [],
                                parents: []
                            },
                            {
                                name: "children 1 children 2",
                                color: "white",
                                children: [],
                                parents: []
                            }
                        ]
                    }
                ]
            }
        
        items = []

        constructor() {
            const canvas = document.getElementById('treeCanvas'); 
            this.canvas = canvas;
            this.ctx = canvas.getContext("2d");
        }


        play() {
            const self = this;
            if (!this.requestId && this.ctx) {
                this.requestId = window.requestAnimationFrame((time) => {
                    self.render(time)
                });
            }
        }

        render (now) {
            this.requestId = undefined;
            this.ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
            this.update(0, 0, this.tree);
            this.draw(this.tree);
            this.play();
        }

        update (x, y, leaf) {
            const width = 100;
            const height = 100;

            let totalWidth = width + 0.5;
            let data = null;

            leaf.y = y * (height + 0.5);
            leaf.x = x * width;

            leaf.width = width;
            leaf.height = height;

            leaf.children?.forEach((c, index) => {
                // totalWidth += width + 0.5;
                data = this.update(x + index, y + 1, c)
                totalWidth += data.totalWidth
                x = data.x
            })

            leaf.totalWidth = totalWidth;

            return { x, totalWidth }
            
        }

        draw (leafe) {
 
            leafe.children?.forEach((c, index) => {
                this.draw(c)
            })

            // this.ctx.beginPath();
            // this.ctx.rect(leafe.x, leafe.y, leafe.width, leafe.height);
            // this.ctx.fillStyle = leafe.color;
            // this.ctx.fill();
            // this.ctx.closePath();
            
            this.ctx.beginPath();
            this.ctx.rect(leafe.x, leafe.y, leafe.totalWidth, leafe.height);
            this.ctx.strokeStyle = 'red';
            this.ctx.lineWidth = 26;
            this.ctx.stroke();
        }

    }
    const visualizer = new Visualizer();
    visualizer.play();
    </script>
  </body>
</html>
